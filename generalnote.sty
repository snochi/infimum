%% this is a format for math and physics notes

%% last date of revision: April 26, 2020
%% version 2.0.7

%% ========================================================
%% package imports

\RequirePackage{afterpage} % blank page after a title page 
\RequirePackage{amsmath}   % many "mathy" things like the equation environment
\RequirePackage{amssymb}   % various math symbols (e.g. qed symbol)
\RequirePackage{amsthm}    % proof environment
\RequirePackage{calc}      % arithmetic on the arguments of the LaTeX commands
\RequirePackage{emptypage} % blank pages in between title, toc, chapter, ...
\RequirePackage{enumitem}  % \begin{enumerate}[leftmargin=\parindet\newindent]
\RequirePackage{etoc}      % \localtableofcontents
\RequirePackage{fancyhdr}  % making document "fancy"
\RequirePackage{fontspec}  % fonts
\RequirePackage{geometry}  % setting the geometry of the document
\RequirePackage{hyperref}  % clickable toc
\RequirePackage{mathptmx}  % times font for math
\RequirePackage{mathtools} % underbrace, underbracket, ...
\RequirePackage{titlesec}  % subsection modification
\RequirePackage{tocloft}   % indentation in toc

\RequirePackage[toc]{appendix}      % appendix
\RequirePackage[T1]{fontenc}        % custom fonts
\RequirePackage[table]{xcolor}      % \color{gray}

%% ========================================================
%% geometry of the paper

\geometry{letterpaper,margin=2cm}

%% =======================================================
%% Serifa Std font

\newfontfamily\serifastd[Ligatures=Tex]{Serifa Std}

%% ========================================================
%% variable bindings

%% counters
\newcounter{thmcounter}              % counter for theorem, proposition, axiom, ...
\newcounter{corcounter}              % counter for corollary
\newcounter{axiomcounter}            % counter for axiom
\newcounter{examplecounter}          % counter for example, note, question, ...

%% lengths
\setlength{\parindent}{3cm}

\newlength{\newindent}
\setlength{\newindent}{3em}

\newlength{\tablelength}
\setlength{\tablelength}{\textwidth - 1.145\parindent}

\newlength{\titlelength}
\setlength{\titlelength}{\textwidth - 0.145\parindent}

%% ========================================================

\definecolor{gray2}{rgb}{0.3,0.3,0.3}
\definecolor{gray3}{rgb}{0.9,0.9,0.9}

%% ========================================================
%% removes the numbering from the subsection but keeps it in the toc
%% moreover, sets the default typeface of the subsection to be gray Serifa Std

\titleformat{\section}{\color{gray2}\serifastd\selectfont\Large\bfseries}{}{0pt}{}

%% ========================================================

\titleformat{\chapter}[display]{\color{gray2}\serifastd\selectfont\Huge\bfseries}{\thechapter. }{0pt}{}

%% ========================================================

\newcommand{\chap}[1]{\chapter{#1}
    \begingroup
    \parindent=0em
    \etocsettocstyle{\color{gray2}\rule{10cm}{1pt}}{\vspace{-5pt}\color{gray2}\rule{10cm}{1pt}}
    \setlength{\cftsecindent}{0pt}
    \renewcommand{\cftdot}{}
    \cftpagenumbersoff{section}
    \localtableofcontents
    \parindent=3cm
    \endgroup
\markboth{#1}{}\thispagestyle{empty}\setcounter{axiomcounter}{0}\setcounter{thmcounter}{0}\setcounter{examplecounter}{0}\clearpage}

%% ========================================================
%% title of table of contents

\renewcommand\contentsname{Table of Contents}

%% ========================================================
%% typeface of table of contents

\renewcommand{\cftchapfont}{\bf\sffamily}
\renewcommand{\cftchappagefont}{\bf\sffamily}
\renewcommand{\cftsecfont}{\normalfont\sffamily}
\renewcommand{\cftsecpagefont}{\normalfont\sffamily}

%% ========================================================
%% clickable toc

\hypersetup{hidelinks}

%% ========================================================
%% enumeration style to (a) (b) (c) ...

\renewcommand{\theenumi}{\alph{enumi}}
\renewcommand{\labelenumi}{(\theenumi)}

%% ========================================================
%% new environments
%% these are used to format the document in certain way

%% definition
\newenvironment{definition_template}[3]
    {\vspace{10pt}\noindent\setlength{\tabcolsep}{0pt} 
        \begin{tabular}{@{}p{\parindent}>{\columncolor{gray2}}p{1mm}p{1mm}p{\textwidth-\parindent-2mm}}
        & & & \textbf{\color{gray2}\fontfamily{phv}\selectfont\small #1. #2} {\color{gray2}\fontfamily{phv}\selectfont\small #3 } \\
        & & &
    }{\\ \end{tabular}\setlength{\tabcolsep}{0.4pt}\vspace{10pt}}


\newenvironment{definition}[2]{\begin{definition_template}{Def'n} {#1}{#2}}{\end{definition_template}}
\newenvironment{recall}    [2]{\begin{definition_template}{Recall}{#1}{#2}}{\end{definition_template}}

%% statements (e.g. theorem, proposition, axiom, ...)

\newenvironment{statement_template}[2]
    {\stepcounter{thmcounter}\setcounter{corcounter}{0}\vspace{5pt}\noindent 
    \begin{tabular}{@{}p{\parindent}@{}p{\textwidth-\parindent}}
        \textbf{\fontfamily{phv}\selectfont #1 \thechapter.\thethmcounter. } & \textbf{\fontfamily{phv}\selectfont #2} 
    \end{tabular}

    \vspace{5pt}\bgroup\def\arraystretch{1.5}\begin{tabular}{>{\columncolor{gray3}}p{\tablelength}}}
    {\\ \end{tabular}\egroup\vspace{5pt}}

\newenvironment{cor}[1]
    {\stepcounter{corcounter}\vspace{5pt}\noindent 
    \begin{tabular}{@{}p{\parindent}@{}p{\textwidth-\parindent}}
        \textbf{\fontfamily{phv}\selectfont Corollary \thechapter.\thethmcounter.\thecorcounter. } & \textbf{\fontfamily{phv}\selectfont #1} 
    \end{tabular}

    \vspace{5pt}\bgroup\def\arraystretch{1.5}\begin{tabular}{>{\columncolor{gray3}}p{\tablelength}}}
    {\\ \end{tabular}\egroup\vspace{5pt}}

\newenvironment{axiom}[1]
    {\stepcounter{axiomcounter}\vspace{5pt}\noindent 
    \begin{tabular}{@{}p{\parindent}@{}p{\textwidth-\parindent}}
        \textbf{\fontfamily{phv}\selectfont Axiom \theaxiomcounter. } & \textbf{\fontfamily{phv}\selectfont #1} 
    \end{tabular}

    \vspace{5pt}\bgroup\def\arraystretch{1.5}\begin{tabular}{>{\columncolor{gray3}}p{\tablelength}}}
    {\\ \end{tabular}\egroup\vspace{5pt}}

\newenvironment{theorem}  [1]{\begin{statement_template}{Theorem}    {#1}}{\end{statement_template}}
\newenvironment{prop}     [1]{\begin{statement_template}{Proposition}{#1}}{\end{statement_template}}
\newenvironment{lemma}    [1]{\begin{statement_template}{Lemma}      {#1}}{\end{statement_template}}
\newenvironment{statement}[1]{\begin{statement_template}{Statement}  {#1}}{\end{statement_template}}
\newenvironment{claim}    [1]{\begin{statement_template}{Claim}      {#1}}{\end{statement_template}}
\newenvironment{prin}     [1]{\begin{statement_template}{Principle}  {#1}}{\end{statement_template}}
\newenvironment{law}      [1]{\begin{statement_template}{Law}        {#1}}{\end{statement_template}}
\newenvironment{post}     [1]{\begin{statement_template}{Postulate}  {#1}}{\end{statement_template}}

%% proof
\newenvironment{Proof}
    {\proof\leftskip=\parindent}
    {\endproof}

%% answer 
\newenvironment{Answer}
    {\proof[Answer]\leftskip=\parindent}
    {\endproof}

%% ========================================================
%% example, note, remark, ...

\newenvironment{example_template}[1]
    {\stepcounter{examplecounter}\vspace{5pt}\setlength{\leftskip}{\parindent}\noindent\textbf{\fontfamily{phv}\selectfont #1 \thechapter.\theexamplecounter.}}
    {
    
    \setlength{\leftskip}{0pt}\vspace{5pt}}

\newenvironment{example} {\begin{example_template}{Example} }{\end{example_template}}
\newenvironment{exercise}{\begin{example_template}{Exercise}}{\end{example_template}}
\newenvironment{note}    {\begin{example_template}{Note}    }{\end{example_template}}
\newenvironment{question}{\begin{example_template}{Question}}{\end{example_template}}
\newenvironment{remark}  {\begin{example_template}{Remark}  }{\end{example_template}}

%% ========================================================

\makeatletter
\def\cleardoublepage{\clearpage\if@twoside%
    \ifodd\c@page\else
    \vspace*{\fill}
    \hfill
    \begin{center}
        \emph{\large This page intentionally left blank.}
    \end{center}
    \vspace{\fill}
    \thispagestyle{empty}
    \newpage
    \if@twocolumn\hbox{}\newpage\fi\fi\fi
}
\makeatother

%% ========================================================
%% automatically shifts equation used outside of box (definition and statement)
\makeatletter
\renewenvironment{equation*}{%
  \mathdisplay@push
  \st@rredtrue \global\@eqnswfalse
  \mathdisplay{equation*}%
  \hspace{\parindent}
}{%
  \endmathdisplay{equation*}%
  \mathdisplay@pop
  \ignorespacesafterend
}
\makeatother

%% ========================================================
%% horizontal line with a word

\newcommand*\ruleline[1]{\par\noindent\raisebox{1ex}{\makebox[\linewidth]{\color{gray2}\rule{10pt}{0.4pt}\hspace{1ex}\raisebox{-0.7ex}{\color{gray2}\textbf{\emph{#1}}}\hspace{1ex}\hrulefill}}}

%% ========================================================
%% sets summation and Cartesian product symbols to ones used in Computer Modern typeface

\DeclareFontFamily{U} {cmex}{}

\DeclareFontShape{U}{cmex}{m}{n}{
  <-8> cmex7
  <8-9> cmex8
  <9-10> cmex9
  <10-> cmex10}{}

\DeclareSymbolFont{Xcmex} {U} {cmex}{m}{n}

\DeclareMathSymbol{\Xdsum}{\mathop}{Xcmex}{88}
\DeclareMathSymbol{\Xtsum}{\mathop}{Xcmex}{80}
\let\sum\relax
\DeclareMathOperator{\sum}{\mathchoice{\Xdsum}{\Xtsum}{\Xtsum}{\Xtsum}}
\DeclareMathSymbol{\Xdprod}{\mathop}{Xcmex}{89}
\DeclareMathSymbol{\Xtprod}{\mathop}{Xcmex}{81}
\let\prod\relax
\DeclareMathOperator{\prod}{\mathchoice{\Xdprod}{\Xtprod}{\Xtprod}{\Xtprod}}

%% ========================================================
%% resets \mathcal fonts

\DeclareMathAlphabet{\mathcal}{OMS}{cmsy}{m}{n}

%% ========================================================
%% frequently used characters (e.g. \N for the set of natural numbers)

\newcommand{\N}{\mathbb{N}}
\newcommand{\Z}{\mathbb{Z}}
\newcommand{\Q}{\mathbb{Q}}
\newcommand{\R}{\mathbb{R}}
\newcommand{\C}{\mathbb{C}}
\newcommand{\F}{\mathbb{F}}
\newcommand{\lin}{\mathcal{L}}
\newcommand{\alg}{\mathcal{A}}

%% ========================================================
%% isomorphism, partial order, ...

\newcommand{\iso}{\cong}      % isomorphism and congruence shares the same symbol
\newcommand{\po}{\preceq}     % po stands for partial order
\newcommand{\union}{\bigcup}
\newcommand{\insec}{\bigcap}

%% ========================================================
%% evaluating definite integral

\newcommand*\inteval[3]{\Bigl.#1\Bigr\rvert^{#2}_{#3}}

%% ========================================================
%% some math operators are declared for convenience

%% operators for properties of linear transformation
\DeclareMathOperator{\spn}{span}
\DeclareMathOperator{\nullity}{nullity}
\DeclareMathOperator{\rank}{rank}

%% operators for fundamental subspaces of a matrix
\DeclareMathOperator{\nul}{Null}
\DeclareMathOperator{\col}{Col}
\DeclareMathOperator{\row}{Row}

%% adjugate
\DeclareMathOperator{\adj}{adj}

%% ========================================================
%% differentials

\let\d\relax
\DeclareMathOperator{\d}{\,d}
\DeclareMathOperator{\dr}{\,d\emph{r}}
\DeclareMathOperator{\dt}{\,d\emph{t}}
\DeclareMathOperator{\du}{\,d\emph{u}}
\DeclareMathOperator{\dv}{\,d\emph{v}}
\DeclareMathOperator{\dx}{\,d\emph{x}}
\DeclareMathOperator{\dy}{\,d\emph{y}}
\DeclareMathOperator{\dz}{\,d\emph{z}}

%% partial differentials
\let\p\relax
\DeclareMathOperator{\p}{\,\partial}
\DeclareMathOperator{\pr}{\,\partial\emph{r}}
\DeclareMathOperator{\pt}{\,\partial\emph{t}}
\DeclareMathOperator{\pu}{\,\partial\emph{u}}
\DeclareMathOperator{\pv}{\,\partial\emph{v}}
\DeclareMathOperator{\px}{\,\partial\emph{x}}
\DeclareMathOperator{\py}{\,\partial\emph{y}}
\DeclareMathOperator{\pz}{\,\partial\emph{z}}

%% ========================================================
%% gradient

\DeclareMathOperator{\del}{\nabla}

%% ========================================================
%% greek latters

\DeclareMathOperator{\varep}{\varepsilon}
\DeclareMathOperator{\varth}{\vartheta}
\DeclareMathOperator{\varka}{\varkappa}
\DeclareMathOperator{\varsi}{\varsigma}

%% ========================================================
%% physics units

%% SI fundamental units
%% notice that gram is used instead of kilogram,
%% since we are going to use prefixes for k in kg
\DeclareMathOperator{\meter}{m}
\DeclareMathOperator{\second}{s}
\DeclareMathOperator{\ampere}{A}
\DeclareMathOperator{\gram}{g}
\DeclareMathOperator{\kelvin}{K}
\DeclareMathOperator{\mole}{mol}
\DeclareMathOperator{\candela}{cd}

%% SI derived units
\DeclareMathOperator{\coulomb}{C}
\DeclareMathOperator{\voltage}{V}
\DeclareMathOperator{\newton}{N}
\DeclareMathOperator{\joule}{J}
\DeclareMathOperator{\electronvolt}{eV}
\DeclareMathOperator{\watt}{W}
\DeclareMathOperator{\farad}{F}
\DeclareMathOperator{\ohm}{\emph{\Omega}}
\DeclareMathOperator{\weber}{Wb}
\DeclareMathOperator{\tesla}{T}

%% prefixes
\DeclareMathOperator{\giga}{G}
\DeclareMathOperator{\mega}{M}
\DeclareMathOperator{\kilo}{k}
\DeclareMathOperator{\hecto}{h}
\DeclareMathOperator{\deca}{da}
\DeclareMathOperator{\deci}{d}
\DeclareMathOperator{\centi}{c}
\DeclareMathOperator{\milli}{m}
\DeclareMathOperator{\micro}{\emph{\mu}}
\DeclareMathOperator{\nano}{n}
\DeclareMathOperator{\pico}{p}

%% ========================================================
%% qedsymbol

\renewcommand\qedsymbol{\spadesuit}

%% ========================================================
%% pagestyle

\pagestyle{fancy}

%% ========================================================
%% headers

\fancyhf{}
\lhead{}
\rhead{\nouppercase{\leftmark}}
\cfoot{\thepage}
